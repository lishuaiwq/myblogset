---
title: ARP协议
date: 2018-05-17 15:55:10
tags: 
categories: 
- 网络学习
- 网络层
---

# 地址解析协议ARP的简介

## 作用

> 如果一台主机要将一个帧发送到另一台主机, 仅知道这台主机的I P 地址是不够的, 还需要知道主机在网络中的有效硬件地址。操作系统软件( 即以太网驱动程序) 必须知道目的主机的硬件地址, 以便直接向它发送数据。对于T C P / I P 网络,地址解析协议( A R P ) [ R F C O 8 2 6 ] 提供了一种在I P v 4 地址和各种网络技术使用的硬件地址之间的映射。

 - ``地址解析是发现两个地址之间的映射关系的过程。对于使用I P v 4 的T C P / I P 协议族, 这是由运行的A R P 来实现的o A R P 是一个通用的协议, 从这个意义上来看, 它被设计为支持多种地址之间的映射。实际上, A R P 几乎总是用于3 2 位I P v 4 地址和以太网的4 8 位M A C地址之间的映射。``
 - ``A R P 提供从网络层地址到相关硬件地址的动态映射。我们使用动态这个术语是因为它会自动执行和随时间变化, 而不需要系统管理员重新配置。也就是说, 如果一台主机改变它的网络接日卡, 从而改变了它的硬件地址( 但保留其分配的I P 地址) , A R P 可以在一定延时后继续正常运作o A R P 操作通常与用户或系统管理员无关``

## 层次

> 由于IP协议使用了ARP协议，因此通常就把ARP协议划归网络层。但是ARP协议的用途是为了从网络层使用的IP地址解析出在数据链路层使用的硬件地址。因为有的时候按照协议所用将其划分在链路层，这样做当然也是可以的。

- ARP分层的位置是TCP/IP的网络层
- ARP报文是由以太网帧进行封装传输的。没有封装进IP包。
- 实际上，对网络接口层的以太网帧来讲，它们同样是帧的上层协议，当收到以太帧时，根据帧的协议字段判断是送到ARP还是IP。
- 之所以不把它放在数据链路层，是因为它并不具备数据链路层的功能，它的作用是为数据链路层提供接收方的帧地地址

![](https://i.imgur.com/xBQ6vYT.jpg)

# ARP缓存

> A R P 高效运行的关键是维护每个主机和路由器上的A R P 缓存( 或表) 。该缓存使用地址解析为每个接日维护从网络层地址到硬件地址的最新映射。当I P v 4 地址映射到硬件地址时, 它对应于高速缓存中的一个条目,这个映射表会经常的动态更新（新增或者超时删除），一般存储时间是20分钟左右，这种机制是很重要的。因为某个电脑的网络适配器坏了，那么意味着他就要换一个新的网络适配器，即有一个新的MAC地址，但是可能他的IP并不变，所以我们需要随时更新ARP缓存表中的内容，保存最新的实时映射状态。

![](https://i.imgur.com/gEzcHVc.jpg)

 - 我们使用arp-a命令查看ARP缓存的条目时可以看见动态的和静态的类型。那么什么是动态的，什么是静态的呢？
  - 动态条目：表示动态获取到的条目
  - 静态条目：表示手动配置的条目
[https://blog.csdn.net/daxueba/article/details/44956123](https://blog.csdn.net/daxueba/article/details/44956123 "相关博客")

# 一次ARP的执行过程

- 这里的例子是同一个局域网中的

1. 当主机A要向本局域网上的主机B发送IP数据报的时候(需要将逻辑地址转换为物理地址的，不然的话发送不出去的)，首先在其ARP缓存中查看有无主机B的ip地址。如果有则根据映射关系找到对应的主机B的MAC地址，将这个MAC地址直接写入数据帧。通过局域网将此数据报发送给主机B。
2. 如果没有在ARP缓存中没有查询到主机B的IP地址的项目。这有可能是主机B刚接入网络，也可能是主机A刚通电，其高速缓存还是空的。在这种情况下，主机A就自动运行ARP
3. ARP进程在本局域网上广播一个ARP请求分组，ARP请求分组的主要内容是我的IP是209.0.0.5,硬件地址是:00-00-c0-15-ad-18.我想知道IP地址为209.0.0.6的主机的硬件地址。
4. 在本局域网上所有主机上运行的ARP进程都收到此ARP的请求分组
5. 主机B的IP地址与ARP请求分组中要查询的IP地址一致，则手下这个ARP请求分组，并且向主机A回应ARP相应分组，在这个相应分组中写入自己的硬件地址。因为其他的主机的IP地址和ARP请求得IP地址不一致，则丢弃ARP请求包。ARP响应分组的主要内容是：我的IP是209.0.0.6，我的硬件地址是:08-00-2b-00-ee-0a.`注意arp响应是单播`
6. 主机A收到ARP响应分组以后，就在其中的ARP缓存中写入主机B的IP地址到硬件地址的映射。然后可以进行引起这次ARP请求得数据报的传送

- 致此一次ARP的请求过程就执行完了。
`注意:主机B在发送ARP请求得时候，将自己的MAC地址和IP也写入ARP请求数据报中了，所以主机B在接收到ARP请求得时候，就顺便将主机A的IP和硬件地址存入缓存，那么主机B给主机A发送数据的时候就不需要在进行ARP请求了，就会方便很多`

- 对于不同局域网上的ARP请求，只是重读上述的过程，通过主机-路由器-主机这样的方式一跳一跳的传递。

# ARP的协议报格式

- ARP协议报是封装在以太网帧中被的发送的

![](https://i.imgur.com/dRc4KKI.jpg)

- 目的地址：目的主机的MAC地址（上例子中为主机B的MAC地址）

- 源地址：发送数据报的MAC地址（上例子中为主机A的MAC地址）

- 帧类型
  - 0x0800表示后面的报文是IP协议报文
  - 0x0806表示后面的报文是ARP协议报文
- 硬件类型：表示硬件地址的类型，值为1表示以太网地址

- 协议类型：表示要映射的协议地址类型。它的值为0x0800表示IP地址类型

- 硬件地址长度和协议地址长度以字节为单位，对于以太网上的IP地址的ARP请求或应答来说，他们的值分别为6和4；

- 操作类型：1表示ARP请求，2表示ARP应答
 
- 发送端MAC地址：发送方设备的硬件地址；

- 发送端IP地址：发送方设备的IP地址；

- 目标MAC地址：接收方设备的硬件地址。

- 目标IP地址：接收方设备的IP地址。

# ARP相关的攻击

> ARP攻击就是通过伪造IP地址和MAC地址实现ARP欺骗，能够在网络中产生大量的ARP通信量使网络阻塞，攻击者只要持续不断的发出伪造的ARP响应包就能更改目标主机ARP缓存中的IP-MAC条目，造成网络中断或中间人攻击。

- ARP的主要攻击就是ARP欺骗（FAQ）

 - 什么是ARP欺骗？
 
 > 在局域网中，黑客经过收到的ARP Request广播包，能够偷听到其它节点的 (IP, MAC) 地址, 黑客就伪装为A，告诉B (受害者) 一个假地址，使得B在发送给A 的数据包都被黑客截取，而A, B 浑然不知。

 `因为这种攻击伤害不是特别大，一般来说也就是让别人的电脑断断网，，详细的了解希望大家自行查阅相关的资料。
    
  